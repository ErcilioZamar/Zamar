# pip install matplotlib yfinance pandas mplcyberpunk
import yfinance as yf
import pandas as pd
import matplotlib.pyplot as plt
import mplcyberpunk

# ticker = ["substitua_pelos_tickers_da_bolsa_e_separe_com_virgula"]
# dados_mercados = yf.download(tickers, period = 6mo, auto_adjust = False
# display(dados_mercado)

# Após ver a tabelona, separa por adj close para visualizar melhor a coluna
dados_mercado = dados_mercado["Adj Close"]
display(dados_mercado)

# Tirar o NaN da tabela
dados_mercado = dados_mercado.dropna()

# Renomear as colunas no luugar dos tickers, para melhor leitura
# dados_mercado.columns = ["Nome certo", "Separados por vírgula", "entre colchetes"]
display(dados_mercado) # Para ver a tabela com os nomes certos das cotações

plt.style.use("cyberpunk") # Para chamar a biblioteca do gráfico
plt.plot(dados_mercado["IBOV"]) # Faz o gráfico da [coluna]
plt.title(IBOVESPA) # Dá nome ao gráfico
plt.savefig("ibovespa.png") # para salvar o gráfico
# Para criar e salvar os gráficos de cada ticker (dolar, bovespa, escambauu) use as 3 últimas linhas de código
# Substituindo o nome do ticker pelo qual você quer fazer o gráfico

# Calcular retornos diários geral
retornos_diarios = dados_mercado.pct_change()
display(retornos_diarios)

# Calcular retornos diários especificamente
retorno_dolar = retornos_diarios["DOLAR"].iloc[-1] # para pegar sempre a última linha da "tabela", independente da quantidade de linhas
retorno_ibov = retornos_diarios["IBOV"].iloc[-1]
retorno_sp500 = retornos_diarios["S&P500"].iloc[-1]
retorno_btc = retornos_diarios["BTC"].iloc[-1]

# Configurar e enviar o email uusando o outlook instalado no pc
import win32com.client as win32
outlook = win32.Dispatch("outlook.application")
email = outlook.CreateItem(0)
email.To = "email que vai receber", 
email.Subject = "Relatório de Mercado"
email.Body = f''' Prezado diretor, segue o rleatório de mercado:

* O Ibovespa teve o retorno de {retorno_ibov}.
* O Dólar teve o retorno de {retorno_dolar}.
* O S&P500 teve o retorno de {retorno_sp500}.
* O BTC teve o retorno de {retorno_btc}.

Segue em anexo a pergormance dos ativos nos últimos 6 meses


At.te,

Ercilio Zamar
Junior Python Developer

'''

anexo_ibovespa = r"D:/Códigos/ibovespa.png"
anexo_dolar = r"D:/Códigos/dolar.png"
anexo_sp500 = r"D:/Códigos/sp500.png"
anexo_btc = r"D:/Códigos/btc.png"


email.Attachments.Add(anexo_ibovespa)
email.Attachments.Add(anexo_dolar)
email.Attachments.Add(anexo_sp500)
email.Attachments.Add(anexo_btc)


email.Send()



